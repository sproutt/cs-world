# TCP / UDP

------

스터디원들의 개별 정리자료 링크

- [김민섭](https://www.notion.so/CS-9bc6faf434904ec2b870c84f8c06280a)
- [이혁진](https://www.notion.so/hyukhyukk/TCP-vs-UDP-c86d09bb8d654f73948570d6b8ff97a6)
- [정회형](https://www.notion.so/hotheadfactory/TCP-UDP-0287fe375d3e437095f12547c947d440)
- [김종근](https://github.com/Bellroute/TIL/blob/master/Network/TCP%EC%99%80UDP.md)

## 전송 계층

> 전송계층은 클라이언트와 서버 간에 **애플리케이션 계층 메시지를 전송** 하는 서비스를 제공한다.

- 서로 다른 호스트에서 동작하는 애플리케이션 프로세스 간의 논리적 통신(logical communication)을 제공
  - 논리적 통신 - 애플리케이션 관점에서 보면 프로세스들이 동작하는 호스트들이 직접 연결된 것처럼 보임을 의미
- 네트워크 라우터가 아닌 **종단(end-point) 시스템** 에서 구현

### 전송 계층의 역할

1. 최소한의 데이터 신뢰성 보장
2. 어플리케이션 계층에 데이터를 네트워크 계층으로 전송 : 다중화
   - 애플리케이션 프로세스로부터 수신한 메시지를 **세그먼트(segment)** 라는 작은 조각으로 분할
   - 각각의 조각에 **헤더**를 추가하여 전송한다.
3. 네트워크 계층의 데이터를 어플리케이션 계층에 전송 : 역다중화
   - 네트워크 계층으로부터 데이터그램에서 추출한 세그먼트를 받음
   - 애플리케이션에서 세그먼트 내부의 데이터를 이용할 수 있도록 세그먼트를 처리

```
다중화란 : 네트워크에 한번에 전송하기에 큰 데이터를 여러 크기로 나누는 과정
```

**전송계층은 애플리케이션의 소켓으로 데이터를 주고 받음**

### 트랜스포트 계층이 없다면?

- 트랜스포트 계층이 없다면, 인터넷 네트워크 계층 프로토콜인 IP(Internet Protocol)을 이용하여 호스트들 간에 논리적 통신을 제공

- IP 서비스 모델은 통신하는 호스트들 간에 세그먼트를 전달하기 위해서 최대한 노력하지만, 어떤 보장도 하지않음 (비신뢰적인 서비스)

  - 세그먼트의 전달
  - 세그먼트의 순서
  - 세그먼트 내부 데이터의 무결성

- 트랜스포트 다중화&역다중화

  에 어려움

  - 트랜스포트 계층 프로토콜인 UDP와 TCP의 가장 기본적인 기능
  - "호스트-대-호스트 전달"을 "프로세스-대-프로세스로 전달"로 확장하는 것

**정리**

> UDP와 TCP는 서로다른 기능을 갖도록 설계된 전송계층 프로토콜이아니라, 전송 계층의 프로토콜이 갖어야하는 최소한의 기능을 가진 프로토콜이 UDP이고 TCP는 UDP의 기능에 신뢰성을 더한 프로토콜이다.

## **UDP**

### **특징**

- 비연결형
- 멀티캐스팅 가능
- 데이터 단위 : 데이터그램
- 자유도가 높은 프로토콜

### **UDP에 적합한 애플리케이션**

- 어떠한 데이터를 언제 보낼지에 대해 애플리케이션레벨에서 더 정교한 제어를할 경우
- 연결 설정이 없을 경우
- 연결 상태가 없을 경우
- 작은 패킷 헤더 오버헤드를 필요로 할 경우

### **UDP 헤더 : 8바이트**

### **UDP 기반의 프로토콜**

1. DNS
2. QUIC
   - 구글에서 만든 프로토콜로 Youtube에서 사용되는 프로토콜
   - 기존의 TCP프로토콜이 가지고 있는 레거시의 한계로 UDP 기반으로 성능을 개선시킨 프로토콜
3. 스프리밍 멀티 서비스

## TCP

### **특징**

- 전이중 : 양방향으로 데이터가 흐를 수 있다.
- 점대점 : 둘 간의 연결만 가능, 멀티캐스팅 불가능이 하다.
- 데이터 단위 : 세그먼트

### **신뢰성 보장을 위한 논리적인 연결과 해제**

- 3 Hands Shaking

  - 송신자 애플리케이션이 데이터를 전송하기 전에 먼저 정확한 전송을 보장하기 위해 수신자 애플리케이션과 사전에 세션을 수립하는 과정을 의미한다

  - [STEP 1]

     Client > Server : TCP SYN

    - A클라이언트는 B서버에 접속을 요청하는 SYN 패킷을 보낸다. 이때 A클라이언트는 SYN 을 보내고 SYN/ACK 응답을 기다리는SYN_SENT 상태가 되는 것이다.

  - [STEP 2]

     Server > Client : TCP SYN ACK

    - B서버는 SYN요청을 받고 A클라이언트에게 요청을 수락한다는 ACK 와 SYN flag 가 설정된 패킷을 발송하고 A가 다시 ACK으로 응답하기를 기다린다. 이때 B서버는 SYN_RECEIVED 상태가 된다.

  - [STEP 3]

     Client > Server : TCP ACK

    - B서버는 SYN요청을 받고 A클라이언트에게 요청을 수락한다는 ACK 와 SYN flag 가 설정된 패킷을 발송하고 A가 다시 ACK으로 응답하기를 기다린다. 이때 B서버는 SYN_RECEIVED 상태가 된다.

  - 양쪽 모두 통신할 준비가 되었다는 것을 보장하고, 실제로 데이터 전달 전에 한쪽이 다른 쪽이 준비되었다는 것을 알수 있음.

- 4 Hands Shaking

  - [STEP 1]

     Client > Server : TCP FIN

    - 클라이언트가 연결을 종료하겠다는 FIN플래그를 전송한다.

  - [STEP 2]

     Server > Client : TCP ACK

    - 서버는 일단 확인메시지를 보내고 자신의 통신이 끝날때까지 기다리는데 이 상태가 **TIME_WAIT** 상태다.

  - [STEP 3]

      Server > Client : TCP FIN

    - 서버가 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 FIN플래그를 전송한다.

  - [STEP 4]

      Client > Server : TCP ACK

    - 클라이언트는 확인했다는 메시지를 보낸다.

### **TCP 헤더 20바이트**



### **신뢰성 보장 방법**

- 흐름 제어
  - stop and wait
  - sliding window
- 혼잡 제어
  - AIMD : 윈도우 사이즈를 하나씩 증가시키다 실패시 절반으로 줄임
  - SlowStart : 윈도우 사이즈를 두배씩 늘림 혼잡 발생시 1로 줄임 그리고 혼잡이 발생했던 윈도우 사이즈의 절반까지 2배씩 증가시키고 절반지점에 도달하면 이후부터 1개씩 증가
  - Fast Recovery : 혼잡상태시에 윈도우 사이즈를 1로 줄이지 않고 반으로 줄인 다음 선형 증가

### 정리

> UDP를 쓰면 꼭 신뢰성이 보장이 안되는게 아니다. 애플리케이션 계층에서 신뢰성에 대한 처리를 더 신경써주면 UDP프로토콜을 사용하면서도 신뢰성을 보장 받는 통신을 할 수 있다. 또한 신뢰성이 있다고 반드시 TCP를 쓰는게 정답은 아니다. TCP는 신뢰성을 보장하는 만큼 신뢰성 처리를 위한 오버헤드가 큼 따라서 시스템 특징에 맞게 적절한 선택이 필요

## Quiz

```
Q. 전송계층의 논리적 통신과 네트워크 계층의 논리적 통신의 차이점에 대해 설명해보시오 

A. 전송계층 : 프로세스들사이에서의 논리적 통신 네트워크계층 : 호스트들사이에서의 논리적 통신
```

```
Q. 혼잡제어와 흐름제어의 차이에 대해서 설명하시오
```

```
Q. 전송계층의 다중화와 역 다중화에 대해서 설명하시오

A. 다중화 : 애플리케이션계층에서 만들어져서 소켓을 통해 받은 데이터를 헤더 정보와 함께  세그먼트로 캡슐화하고 네트워크 계층으로 전달하는 작업 역다중화 : 세그먼트의 데이터를 올바른 소켓에 전송
```

```
Q. 잃어버린 패킷 즉 네트워크를 떠돌아다니는 패킷은 어떻게 처리되는가?
```

```
Q. 슬라이딩 윈도우를 통해 한번에 세개의 패킷이 전송된다고 가정하자. 클라이언트 측에서 1번 패킷은 받고 2번 패킷은 분실되어 받지 못한 상황에서 3번 패킷이 전달 되었을때 3번 패킷은 어떻게 되는가?
```

```
Q. HTTP1과 HTTP2의 문제점이 무엇이고 TCP와 연관지어서 설명해보시오
```

```
Q.  TCP / UDP의 사용 사례에 대해 설명하시오
```